(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{1874:function(e,t,a){Promise.resolve().then(a.bind(a,628))},628:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return x}});var r=a(7437),s=a(2265),l=a(9376),n=a(7648),d=a(1837),o=a(9064),i=a(1217),c=a(7569);function u(){var e,t,a,u;let x=(0,l.useRouter)(),m=(0,l.useSearchParams)().get("barberId"),{user:h,isAuthenticated:v}=(0,i.t)(),[f,b]=(0,s.useState)([]),[p,g]=(0,s.useState)(null),[y,j]=(0,s.useState)([]),[N,k]=(0,s.useState)(""),[w,S]=(0,s.useState)(!0),[_,A]=(0,s.useState)(!1),[E,z]=(0,s.useState)(!1),C=(0,s.useRef)(!1);(0,s.useEffect)(()=>{if(!v){x.push("/login?redirect=/chat");return}T()},[v,x]),(0,s.useEffect)(()=>{v&&m&&!C.current&&!w&&(C.current=!0,d.Z.get("/chat",{params:{barberId:m}}).then(e=>{var t;if(!e.data.success||!(null===(t=e.data.data)||void 0===t?void 0:t.chat))return;let a=e.data.data.chat;return d.Z.get("/chat/user/chats").then(e=>{var t;if(e.data.success&&(null===(t=e.data.data)||void 0===t?void 0:t.chats)){let t=e.data.data.chats;b(t),g(t.find(e=>e._id===a._id)||a)}else g(a)})}).then(()=>window.history.replaceState({},"","/chat")).catch(()=>o.ZP.error("Could not open chat")).finally(()=>{C.current=!1}))},[v,m,w]),(0,s.useEffect)(()=>{if(!(null==p?void 0:p._id)){j([]);return}A(!0),d.Z.get("/chat/".concat(p._id,"/messages")).then(e=>{var t,a;e.data.success&&(null===(a=e.data.data)||void 0===a?void 0:null===(t=a.chat)||void 0===t?void 0:t.messages)?j(e.data.data.chat.messages):j([])}).catch(()=>j([])).finally(()=>A(!1))},[null==p?void 0:p._id]);let T=async()=>{try{var e;let t=await d.Z.get("/chat/user/chats");t.data.success?b((null===(e=t.data.data)||void 0===e?void 0:e.chats)||[]):b([])}catch(e){b([])}finally{S(!1)}},I=async()=>{let e=N.trim();if(e&&(null==p?void 0:p._id)&&!E){z(!0);try{var t;await d.Z.post("/chat/message",{chatId:p._id,content:e}),k("");let a={sender:null!==(t=null==h?void 0:h.id)&&void 0!==t?t:"",senderType:"user",content:e,messageType:"text",read:!1,createdAt:new Date().toISOString()};j(e=>[...e,a]),T()}catch(e){o.ZP.error("Failed to send message")}finally{z(!1)}}},Z=null==p?void 0:null===(e=p.participants)||void 0===e?void 0:e.barber;return v?(0,r.jsxs)("div",{className:"min-h-screen bg-[var(--bg-primary)] flex flex-col",children:[(0,r.jsx)("nav",{className:"sticky top-0 z-50 border-b border-[var(--border)] bg-[var(--bg-secondary)]/95 backdrop-blur",children:(0,r.jsxs)("div",{className:"container mx-auto px-4 sm:px-6 py-4 flex justify-between items-center",children:[(0,r.jsx)(n.default,{href:"/dashboard",className:"text-xl font-bold text-forest dark:text-gold-light",children:"BarberApp"}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(n.default,{href:"/dashboard",className:"text-sm text-[var(--text-secondary)] hover:underline",children:"Dashboard"}),(0,r.jsx)(c.T,{})]})]})}),(0,r.jsxs)("div",{className:"container mx-auto px-4 py-4 flex-1 flex flex-col max-w-4xl",children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-[var(--text-primary)] mb-4",children:"Messages"}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 border border-[var(--border)] rounded-xl bg-[var(--bg-secondary)] overflow-hidden",children:[(0,r.jsx)("aside",{className:"w-full sm:w-72 border-b sm:border-b-0 sm:border-r border-[var(--border)] flex flex-col",children:w?(0,r.jsx)("div",{className:"p-4 text-sm text-[var(--text-muted)]",children:"Loading chats..."}):0===f.length?(0,r.jsx)("div",{className:"p-4 text-sm text-[var(--text-muted)]",children:"No conversations yet. Book a barber to start chatting."}):(0,r.jsx)("ul",{className:"overflow-y-auto flex-1",children:f.map(e=>{var t,a,s,l,n,d;let o=null===(t=e.participants)||void 0===t?void 0:t.barber,i=(null==p?void 0:p._id)===e._id;return(0,r.jsx)("li",{children:(0,r.jsxs)("button",{type:"button",onClick:()=>g(e),className:"w-full text-left px-4 py-3 flex items-center gap-3 hover:bg-[var(--bg-tertiary)] ".concat(i?"bg-forest/10 dark:bg-gold/10 border-l-2 border-forest dark:border-gold":""),children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-full bg-forest/10 dark:bg-gold/10 flex items-center justify-center text-forest dark:text-gold font-semibold shrink-0",children:null!==(l=null==o?void 0:null===(a=o.name)||void 0===a?void 0:a.charAt(0))&&void 0!==l?l:"?"}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsx)("p",{className:"font-medium text-[var(--text-primary)] truncate",children:null!==(n=null==o?void 0:o.name)&&void 0!==n?n:"Barber"}),(0,r.jsx)("p",{className:"text-xs text-[var(--text-muted)] truncate",children:null!==(d=null===(s=e.lastMessage)||void 0===s?void 0:s.content)&&void 0!==d?d:"No messages yet"})]})]})},e._id)})})}),(0,r.jsx)("main",{className:"flex-1 flex flex-col min-h-[300px]",children:p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"px-4 py-3 border-b border-[var(--border)] flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-full bg-forest/10 dark:bg-gold/10 flex items-center justify-center text-forest dark:text-gold font-semibold",children:null!==(a=null==Z?void 0:null===(t=Z.name)||void 0===t?void 0:t.charAt(0))&&void 0!==a?a:"?"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold text-[var(--text-primary)]",children:null!==(u=null==Z?void 0:Z.name)&&void 0!==u?u:"Barber"}),(null==Z?void 0:Z.shopName)&&(0,r.jsx)("p",{className:"text-xs text-[var(--text-muted)]",children:Z.shopName})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:_?(0,r.jsx)("p",{className:"text-sm text-[var(--text-muted)]",children:"Loading messages..."}):0===y.length?(0,r.jsx)("p",{className:"text-sm text-[var(--text-muted)]",children:"No messages yet. Say hello!"}):y.map((e,t)=>(0,r.jsx)("div",{className:"flex ".concat("user"===e.senderType?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"max-w-[80%] rounded-xl px-4 py-2 ".concat("user"===e.senderType?"bg-forest dark:bg-gold text-white":"bg-[var(--bg-tertiary)] text-[var(--text-primary)]"),children:[(0,r.jsx)("p",{className:"text-sm",children:e.content}),(0,r.jsx)("p",{className:"text-xs opacity-70 mt-1",children:new Date(e.createdAt).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})})]})},t))}),(0,r.jsxs)("div",{className:"p-4 border-t border-[var(--border)] flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:N,onChange:e=>k(e.target.value),onKeyDown:e=>"Enter"===e.key&&!e.shiftKey&&I(),placeholder:"Type a message...",className:"flex-1 px-4 py-3 bg-[var(--bg-tertiary)] border border-[var(--border)] rounded-lg text-[var(--text-primary)] placeholder-[var(--text-muted)]"}),(0,r.jsx)("button",{type:"button",onClick:I,disabled:!N.trim()||E,className:"px-5 py-3 bg-forest dark:bg-gold text-white font-medium rounded-lg hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed",children:E?"...":"Send"})]})]}):(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center text-[var(--text-muted)] text-sm p-4",children:"Select a conversation or book a barber to start chatting."})})]})]})]}):null}function x(){return(0,r.jsx)(s.Suspense,{fallback:(0,r.jsx)("div",{className:"min-h-screen bg-[var(--bg-primary)] flex items-center justify-center",children:(0,r.jsx)("p",{className:"text-[var(--text-muted)]",children:"Loading..."})}),children:(0,r.jsx)(u,{})})}},7569:function(e,t,a){"use strict";a.d(t,{T:function(){return l}});var r=a(7437),s=a(2265);function l(){let[e,t]=(0,s.useState)(!1),[a,l]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{l(!0),t(document.documentElement.classList.contains("dark"))},[]),(0,s.useEffect)(()=>{a&&(e?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light")))},[e,a]),(0,s.useEffect)(()=>{if(!a)return;let e=localStorage.getItem("theme"),r=window.matchMedia("(prefers-color-scheme: dark)").matches;t("dark"===e||!e&&r)},[a]),a)?(0,r.jsx)("button",{type:"button",onClick:()=>t(e=>!e),className:"p-2 rounded-brand-md bg-stone-200 dark:bg-stone-700 text-stone-700 dark:text-stone-200 hover:bg-stone-300 dark:hover:bg-stone-600 transition-colors","aria-label":"Toggle theme",children:e?(0,r.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"})}):(0,r.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"})})}):null}},1837:function(e,t,a){"use strict";let r=a(3464).Z.create({baseURL:"https://barber-app-backend.vercel.app/api",headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{{let a=localStorage.getItem("auth-storage");if(a)try{var t;let r=JSON.parse(a);(null===(t=r.state)||void 0===t?void 0:t.token)&&(e.headers.Authorization="Bearer ".concat(r.state.token))}catch(e){console.error("Error parsing auth storage:",e)}}return e}),r.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("auth-storage"),window.location.href="/login"),Promise.reject(e)}),t.Z=r},1217:function(e,t,a){"use strict";a.d(t,{t:function(){return l}});var r=a(9625),s=a(6885);let l=(0,r.Ue)()((0,s.tJ)(e=>({user:null,token:null,isAuthenticated:!1,_hasHydrated:!1,setAuth:(t,a)=>e({user:t,token:a,isAuthenticated:!0}),logout:()=>e({user:null,token:null,isAuthenticated:!1}),setHasHydrated:t=>e({_hasHydrated:t})}),{name:"auth-storage",partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated}),onRehydrateStorage:()=>e=>{l.getState().setHasHydrated(!0)}}))}},function(e){e.O(0,[648,64,464,299,971,117,744],function(){return e(e.s=1874)}),_N_E=e.O()}]);